server setup
============

install debian with xfce4

run "su -" (not just "su") for superuser with proper path env var set

# nano /etc/apt/sources.list
----
deb http://deb.debian.org/debian/ buster main contrib non-free
deb http://security.debian.org/debian-security buster/updates main contrib non-free
deb http://deb.debian.org/debian/ buster-updates main contrib non-free
----

# apt-get update
# apt-get upgrade

# apt-get install build-essential module-assistant
# m-a prepare

insert guest additions cd image (from virtualbox toolbar)

# cd /media/cdrom
# bash VBoxLinuxAdditions.run

reboot system for guest addition kernel modules to take effect

~~~~

# apt-get install wkhtmltopdf msttcorefonts php apache2 mariadb-server php-gd git geany

# nano /etc/apache2/envvars
----
export APACHE_RUN_USER=<myuser>
export APACHE_RUN_GROUP=<myuser>
----

# nano /etc/apache2/apache2.conf
----
ServerName <your-server-name>
----

$ cd ~
$ mkdir dev
$ cd dev
$ mkdir apache_logs
$ mkdir public
$ mkdir pwd
$ mkdir temp
$ cd pwd
$ touch sql_admin
$ touch sql_user

sql_admin:
----
webdb_admin
<password>
----

sql_user:
----
webdb_user
<password>
----

# nano /etc/apache2/sites-available/000-default.conf
----
DocumentRoot /home/<myuser>/dev/public/
DirectoryIndex index.php

<Directory /home/<myuser>/dev/public>
  Options Indexes FollowSymLinks
  AllowOverride all
  Require all granted
</Directory>

ErrorLog /home/<myuser>/dev/apache_logs/error.log
CustomLog /home/<myuser>/dev/apache_logs/access.log combined
----

# service apache2 reload

# mysql_secure_installation
follow prompts

# mysql -u root -p
> create user 'webdb_admin'@'localhost' identified by '<password>';
> grant all privileges on *.* to 'webdb_admin'@'localhost';
> create user 'webdb_user'@'localhost' identified by '<password>';
> grant select,insert,update,delete on *.* to 'webdb_user'@'localhost';
> exit

# adduser <myuser> vboxsf

$ php my_app/index.php load_webdb_schema
executes webdb/sql/schema.sql
(don't run on webdb index.php because requires database access parameters in settings.php)

$ php my_app/index.php load_app_schema
executes my_app/sql/schema.sql
(don't run on webdb index.php because requires database access parameters in settings.php)

TODO: make a bit clearer where to run these from, and also how the common settings file works

~~~~

# apt-get install phpmyadmin
# nano /var/lib/phpmyadmin/blowfish_secret.inc.php
use https://www.question-defense.com/tools/phpmyadmin-blowfish-secret-generator to generate string
# chown myuser:myuser /var/lib/phpmyadmin/blowfish_secret.inc.php
# chmod 600 /var/lib/phpmyadmin/blowfish_secret.inc.php
